# ゲストモード実装ドキュメント

## 概要
ユーザー登録なしで財務計画計算機を利用できるゲストモード機能を実装しました。

## 実装内容

### バックエンド
- **計算エンドポイントの認証解除**: `/api/calculations/*` エンドポイントを認証不要のグループに移動し、ゲストユーザーでも計算機能を利用できるようにしました。

### フロントエンド

#### 1. ゲストモードコンテキスト (`GuestModeContext.tsx`)
- ローカルストレージを使用してゲストモードの状態と財務データを管理
- 主な機能:
  - `isGuestMode`: ゲストモードかどうかの状態
  - `guestData`: ゲストモードで入力した財務データ
  - `startGuestMode()`: ゲストモードを開始
  - `exitGuestMode()`: ゲストモードを終了（データもクリア）
  - `setGuestData()`: ゲストデータを保存
  - `clearGuestData()`: ゲストデータをクリア

#### 2. 財務データコンテキストの拡張 (`FinancialDataContext.tsx`)
- ゲストモード時はローカルストレージに財務データを保存
- 認証済みユーザー時はAPIを通じてサーバーに保存
- すべての財務データ操作（作成、更新、削除）でゲストモード対応

#### 3. ユーザーフックの拡張 (`useUser.ts`)
- ゲストモード時は固定の`userId: 'guest'`を返す
- `isGuest`フラグを追加して、ゲストモードかどうかを判定可能

#### 4. ホームページの更新 (`page.tsx`)
- 認証状態に応じたボタン表示:
  - 認証済み: 「ダッシュボードを開く」
  - 未認証: 「ゲストとして始める」と「ログイン / 登録」
- ゲストモード説明文の追加

#### 5. ナビゲーションバーの更新 (`Navigation.tsx`)
- ゲストモード時の表示:
  - 「✨ ゲストモード」バッジ
  - 「登録してデータを保存」ボタン（目立つプライマリカラー）
- 3つの状態を適切に表示:
  1. 認証済み: メールアドレス + ログアウトボタン
  2. ゲストモード: ゲストバッジ + 登録ボタン
  3. 未認証: ログインボタン

#### 6. 登録ページの更新 (`register/page.tsx`)
- ゲストデータの自動移行機能:
  - ゲストモードで入力したデータがある場合、登録ページにお知らせを表示
  - 「ゲストモードで入力した財務データを保存する」チェックボックスを追加（デフォルトでON）
  - 登録成功後、チェックが入っていればゲストデータをサーバーに保存

## 使用フロー

### ゲストとして開始
1. ホームページで「ゲストとして始める」をクリック
2. ゲストモードが開始され、ダッシュボードに遷移
3. 財務データ入力、計算機能の利用が可能（データはブラウザのローカルストレージに保存）

### ゲストから登録ユーザーへ移行
1. ゲストモードで使用中、ナビゲーションバーの「登録してデータを保存」をクリック
2. 登録ページでメールアドレスとパスワードを入力
3. 「ゲストモードで入力した財務データを保存する」にチェック（デフォルトでON）
4. 登録完了後、ゲストデータが自動的にサーバーに保存される

## 技術的な詳細

### データの保存場所
- **ゲストモード**: `localStorage`
  - キー: `guest_mode` (モード状態)
  - キー: `guest_financial_data` (財務データ)
- **認証ユーザー**: PostgreSQLデータベース（API経由）

### 制限事項
- ゲストモードのデータはブラウザのローカルストレージに保存されるため:
  - ブラウザのキャッシュをクリアすると失われる
  - 他のデバイスやブラウザからはアクセスできない
  - 目標設定やレポート生成などの一部機能は認証が必要（実装により異なる）

### セキュリティ
- 計算エンドポイントは認証不要だが、ユーザーデータを保存するエンドポイント（財務データ、目標、レポート）は引き続き認証が必要
- ゲストモードではユーザー固有のデータはサーバーに送信されない

## 今後の拡張案
- ゲストモードでの目標設定機能（ローカルストレージ使用）
- ゲストモードでのレポート生成（サーバー保存なし）
- ゲストデータのエクスポート/インポート機能
- ゲストモードの使用期限やデータサイズ制限の追加
