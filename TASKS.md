# Repository Improvement Tasks

This document outlines the top 5 prioritized tasks identified for improving the `financial-planning-calculator` repository, along with estimated effort and reasoning.

---

### 1. フロントエンドのテストカバレッジ向上

*   **優先度:** **高**
*   **工数:** **M (中規模、数日)**
*   **課題:** フロントエンド (`frontend/src`) には多くのUIコンポーネントや計算ロジック (`AssetProjectionCalculator.tsx` など) がありますが、それらに対する単体テストや結合テストがほとんど見当たりません。現状では、手動でのE2Eテスト (`e2e/tests/health-check.spec.ts`) に頼っている状態です。
*   **影響:** 新機能の追加やリファクタリングの際に、意図しないバグ（デグレード）が発生するリスクが非常に高いです。特に金融計算というアプリケーションの性質上、正確性の担保は最重要です。
*   **提案:** `Jest` と `React Testing Library` を導入し、まずは主要な計算コンポーネントと、状態管理を行っているカスタムフック (`useFinancialData`など) からテストを作成していくことを推奨します。

---

### 2. バックエンドのエラーハンドリングとロギングの強化

*   **優先度:** **高**
*   **工数:** **S (小規模、数時間〜1日)**
*   **課題:** 現在のバックエンドコード（特に `application/usecases` と `infrastructure/web/controllers`) では、エラーが発生した際に単純に上位に `error` を返却する箇所が多く、エラーの種類や発生箇所を特定するためのコンテキスト情報が不足しています。
*   **影響:** 本番環境で問題が発生した際に、原因調査が困難になります。
*   **提案:** エラーにコンテキスト情報を付与する（例: `fmt.Errorf("usecase: failed to save plan: %w", err)`）、または構造化ロギングライブラリ（例: `log/slog` (Go 1.21+), `zerolog`）を導入し、エラー発生時にリクエストIDやユーザーIDなどの関連情報をログに出力するように修正します。

---

### 3. 設定値のハードコーディングの排除 ✅ **完了 (2025-12-29)**

*   **優先度:** **中**
*   **工数:** **S (小規模、数時間〜1日)**
*   **課題:** `backend/config/server.go` 内の `DefaultPort` や、`backend/main.go` 内のタイムアウト値など、一部の設定値がコード内に直接書き込まれています（ハードコーディング）。
*   **影響:** 環境ごと（開発、ステージング、本番）に設定を変えたい場合に、コードの修正と再ビルドが必要になってしまいます。
*   **提案:** これらの設定値を `config.go` の構造体に集約し、`.env` ファイルや環境変数から読み込めるように統一します。これにより、アプリケーションの柔軟性とポータビリティが向上します。

**実装内容:**
- `ServerConfig` に `CORSMaxAge` と `CleanupInterval` フィールドを追加し、環境変数 `CORS_MAX_AGE` と `CLEANUP_INTERVAL` から読み込むように実装
- `middleware.go` のハードコーディングされた CORS MaxAge (86400) と RateLimiter Store値 (100) を設定から読み込むように変更
- `TemporaryFileStorage` のクリーンアップ間隔を環境変数で設定可能に変更
- `.env.example` に新規環境変数を追記
- セキュリティ警告機能を追加（`DB_PASSWORD`, `TEMP_FILE_SECRET`, `DB_SSLMODE` のデフォルト値使用時に警告を表示）

---

### 4. フロントエンドの状態管理の複雑化対策

*   **優先度:** **中**
*   **工数:** **M (中規模、数日)**
*   **課題:** 現在、React Context API (`FinancialDataContext`, `GoalsContext`など) を使って状態管理が行われています。これは小〜中規模のアプリケーションには適していますが、今後機能が増えていくと、複数のContextが複雑に絡み合い、パフォーマンスの低下や状態の不整合を引き起こす可能性があります。
*   **影響:** アプリケーションのスケールに伴い、見通しが悪くなり、メンテナンスが困難になる可能性があります。
*   **提案:** 今後の拡張を見据え、`Zustand` や `Jotai` のような、よりシンプルでパフォーマンスに優れた状態管理ライブラリの導入を検討します。あるいは、Contextの責務をさらに細かく分割し、不要な再レンダリングを `React.memo` などで抑制する最適化を行います。

---

### 5. CI/CDパイプラインの最適化

*   **優先度:** **低**
*   **工数:** **S (小規模、数時間〜1日)**
*   **課題:** `lint.yml` や `test.yml` などのGitHub Actionsワークフローが個別に存在しており、ジョブ間でキャッシュの共有やステップの共通化があまり行われていません。例えば、各ワークフローで `setup-go` や `npm install` が実行されており、非効率です。
*   **影響:** CIの実行時間が長くなり、開発サイクルが遅延する可能性があります。また、ワークフローのメンテナンスコストも高くなります。
*   **提案:** GitHub Actionsの **Reusable Workflows (再利用可能なワークフロー)** を導入し、GoやNode.jsのセットアップ、依存関係のインストールといった共通処理をまとめます。これにより、各ワークフローがシンプルになり、実行時間の短縮も期待できます。
