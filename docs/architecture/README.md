# アーキテクチャドキュメント

財務計画計算機アプリケーションのアーキテクチャに関する包括的なドキュメントです。

## 📚 ドキュメント一覧

このディレクトリには、システム開発に必要な各種技術ドキュメントが含まれています。

### [ER図 (Entity-Relationship Diagram)](./ER_DIAGRAM.md)
データベーススキーマの構造を可視化した図です。

**内容:**
- データベーステーブル構造
- テーブル間のリレーションシップ
- 主キー・外部キー・インデックス
- 制約条件（CHECK、UNIQUE等）
- トリガーとデータベース機能

**対象読者:** データベース設計者、バックエンド開発者

### [クラス図 (Class Diagram)](./CLASS_DIAGRAM.md)
ドメインモデルとアーキテクチャ構造を可視化した図です。

**内容:**
- Clean Architecture / DDDの層構造
- ドメインモデル（エンティティ、値オブジェクト、集約）
- ユースケース
- リポジトリインターフェース
- ドメインサービス

**対象読者:** アーキテクト、バックエンド開発者、新規参加メンバー

### [システム構成図 (System Architecture Diagram)](./SYSTEM_ARCHITECTURE.md)
システム全体の構成とネットワーク構造を可視化した図です。

**内容:**
- システム全体構成
- Docker環境構成
- デプロイメント構成
- ネットワークフロー（認証、計算、レポート生成）
- セキュリティ構成
- 技術スタック詳細

**対象読者:** インフラエンジニア、DevOpsエンジニア、アーキテクト

### [技術選定理由 (Technology Adoption Rationale)](./TECHNOLOGY_DECISIONS.md)
各技術の採用理由と検討した代替案を説明したドキュメントです。

**内容:**
- アーキテクチャパターンの選定理由（Clean Architecture / DDD）
- フロントエンド技術（Next.js, TypeScript, Tailwind CSS等）の採用理由
- バックエンド技術（Go, Echo, PostgreSQL等）の採用理由
- 認証・認可技術（JWT, bcrypt, WebAuthn等）の採用理由
- インフラ技術（Docker, Render.com, GitHub Actions等）の採用理由
- 各技術の代替案とそれらを排除した理由

**対象読者:** アーキテクト、技術選定に関わるメンバー、新規参加メンバー

## 🏗️ アーキテクチャ概要

### システムの目的

財務計画計算機は、ユーザーが将来の資産形成と老後の財務計画を可視化するためのWebアプリケーションです。

### 主要機能

1. **財務データ管理**
   - 月収、支出、貯蓄の入力・管理
   - カテゴリ別の詳細管理

2. **将来予測**
   - 資産推移シミュレーション
   - 複利計算による正確な予測
   - インフレ率を考慮した計算

3. **老後資金計算**
   - 退職年齢と平均寿命に基づく必要資金計算
   - 年金受給額を考慮した不足額算出

4. **目標管理**
   - 複数の財務目標設定
   - 進捗追跡と達成可能性評価
   - 緊急資金目標のサポート

5. **セキュアな認証**
   - ローカル認証（メール/パスワード）
   - OAuth 2.0（GitHub）
   - 2段階認証（TOTP）
   - パスキー認証（WebAuthn/FIDO2）

6. **レポート生成**
   - PDF形式のレポート出力
   - グラフとチャートによる可視化

### アーキテクチャの特徴

#### Clean Architecture / DDD

このアプリケーションは、**Clean Architecture（クリーンアーキテクチャ）**と**DDD（ドメイン駆動設計）**の原則に基づいて設計されています。

**利点:**
- ビジネスロジックとインフラストラクチャの分離
- テストしやすい設計
- フレームワークへの依存度が低い
- 変更に強い柔軟な構造

**レイヤー構造:**
```
┌─────────────────────────────────────┐
│   Presentation Layer (Controllers)  │  ← ユーザーインターフェース
├─────────────────────────────────────┤
│   Application Layer (UseCases)      │  ← ビジネスフロー
├─────────────────────────────────────┤
│   Domain Layer (Entities, Services) │  ← ビジネスロジックの核心
├─────────────────────────────────────┤
│   Infrastructure Layer (DB, API)    │  ← 技術的詳細
└─────────────────────────────────────┘
```

依存の方向: 外側 → 内側（内側は外側を知らない）

#### モダンな技術スタック

- **フロントエンド**: Next.js 14 + TypeScript
- **バックエンド**: Go + Echo Framework
- **データベース**: PostgreSQL 15
- **コンテナ化**: Docker + Docker Compose
- **CI/CD**: GitHub Actions
- **デプロイ**: Render.com

### セキュリティ

複数の認証方式をサポートし、高いセキュリティレベルを実現：

1. **多層防御**
   - HTTPS/TLS通信暗号化
   - JWT認証
   - CORS設定
   - レート制限
   - 入力検証

2. **最新の認証技術**
   - OAuth 2.0対応
   - 2段階認証（TOTP）
   - パスキー（WebAuthn/FIDO2）
   - パスワードレス認証

3. **データ保護**
   - パスワードのbcryptハッシュ化
   - トークンの暗号化
   - データベース通信の暗号化

## 📖 読み方ガイド

### 新規参加メンバー向け

1. **まず読むべきもの**
   - このREADME（全体像の把握）
   - [技術選定理由](./TECHNOLOGY_DECISIONS.md)（なぜこの技術を選んだか理解）
   - [クラス図](./CLASS_DIAGRAM.md)（アーキテクチャ理解）
   - [システム構成図](./SYSTEM_ARCHITECTURE.md)（開発環境理解）

2. **次に読むべきもの**
   - [ER図](./ER_DIAGRAM.md)（データ構造理解）
   - プロジェクトルートの[README.md](../../README.md)（セットアップ手順）

### バックエンド開発者向け

1. [技術選定理由](./TECHNOLOGY_DECISIONS.md) - Go/Echo/PostgreSQLを選んだ理由
2. [クラス図](./CLASS_DIAGRAM.md) - ドメインモデルの理解
3. [ER図](./ER_DIAGRAM.md) - データベーススキーマの理解
4. [システム構成図](./SYSTEM_ARCHITECTURE.md) - APIフローの理解

### フロントエンド開発者向け

1. [技術選定理由](./TECHNOLOGY_DECISIONS.md) - Next.js/TypeScript/Tailwindを選んだ理由
2. [システム構成図](./SYSTEM_ARCHITECTURE.md) - APIエンドポイントの理解
3. [クラス図](./CLASS_DIAGRAM.md) - データモデルの理解

### インフラ/DevOpsエンジニア向け

1. [技術選定理由](./TECHNOLOGY_DECISIONS.md) - Docker/Render.comを選んだ理由
2. [システム構成図](./SYSTEM_ARCHITECTURE.md) - インフラ全体の理解
3. [ER図](./ER_DIAGRAM.md) - データベース構成の理解

### アーキテクト・技術リーダー向け

1. [技術選定理由](./TECHNOLOGY_DECISIONS.md) - 技術選定の根拠と代替案の検討
2. [クラス図](./CLASS_DIAGRAM.md) - アーキテクチャパターンの理解
3. [システム構成図](./SYSTEM_ARCHITECTURE.md) - システム全体の把握

## 🔄 アーキテクチャの進化

### 現在の状態

- ✅ Clean Architecture / DDD採用
- ✅ 多様な認証方式のサポート
- ✅ Docker化された開発環境
- ✅ CI/CD パイプライン
- ✅ 自動デプロイ（プレビュー環境）

### 今後の展開（検討中）

- 📋 キャッシング戦略の実装
- 📋 リードレプリカによる読み取り性能向上
- 📋 イベントソーシングの導入
- 📋 マイクロサービス化の検討
- 📋 GraphQL APIの追加
- 📋 リアルタイム通知機能

## 🛠️ 開発ツール

### ドキュメント生成

このドキュメントのMermaid図は、GitHubで自動的にレンダリングされます。ローカルでプレビューするには：

- **VS Code**: Mermaid Preview拡張機能
- **CLI**: `mmdc`コマンド（mermaid-cli）
- **オンライン**: [Mermaid Live Editor](https://mermaid.live/)

### 図の編集

Mermaid記法を使用することで、テキストベースでバージョン管理が可能です。

**メリット:**
- Gitでの差分管理が容易
- コードレビューでの図の変更確認
- 自動生成・更新が可能
- マージコンフリクトの解決が容易

## 📝 ドキュメントの更新

### 更新が必要なケース

1. **データベーススキーマ変更時**
   - [ER図](./ER_DIAGRAM.md)を更新

2. **ドメインモデル追加・変更時**
   - [クラス図](./CLASS_DIAGRAM.md)を更新

3. **システム構成変更時**
   - [システム構成図](./SYSTEM_ARCHITECTURE.md)を更新

4. **技術スタック変更時**
   - [技術選定理由](./TECHNOLOGY_DECISIONS.md)を更新
   - 変更理由と代替案の検討を記載

5. **新機能追加時**
   - 関連する図を更新
   - このREADMEの「主要機能」を更新

### 更新手順

1. 該当するMarkdownファイルを編集
2. Mermaid記法で図を更新
3. 説明テキストも忘れずに更新
4. PRを作成してレビュー依頼
5. マージ後、自動的にGitHubで表示更新

## 🔗 関連ドキュメント

- [README.md](../../README.md) - プロジェクト概要とセットアップ
- [CONTRIBUTING.md](../../CONTRIBUTING.md) - コントリビューションガイド
- [SETUP.md](../SETUP.md) - セットアップ詳細
- [DOCKER_SETUP.md](../DOCKER_SETUP.md) - Docker環境詳細
- [docs/adr/](../adr/) - アーキテクチャ決定記録（ADR）
- [backend/docs/](../../backend/docs/) - バックエンド固有ドキュメント

## 💡 質問・フィードバック

アーキテクチャに関する質問やフィードバックは、GitHubのIssueまたはDiscussionsでお気軽にお寄せください。

---

**最終更新日**: 2026-02-02  
**メンテナー**: 開発チーム
