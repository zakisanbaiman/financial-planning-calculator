#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# Run lint-staged for formatting
npx lint-staged

# Check if there are staged Go files
if git diff --cached --name-only | grep -q '\.go$'; then
  echo "ğŸ“ Checking Go files..."
  cd backend && go fmt ./... && go vet ./...
  if [ $? -ne 0 ]; then
    echo "âŒ Go checks failed"
    exit 1
  fi
fi

# Check if there are staged frontend files
if git diff --cached --name-only | grep -q '^frontend/.*\.\(ts\|tsx\|js\|jsx\)$'; then
  echo "ğŸ“ Checking frontend files..."
  cd frontend && npm run type-check
  if [ $? -ne 0 ]; then
    echo "âŒ Frontend type check failed"
    exit 1
  fi
fi

echo "âœ… Pre-commit checks passed!"
