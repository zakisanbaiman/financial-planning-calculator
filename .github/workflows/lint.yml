name: Lint

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
    golangci-lint:
      name: Go Lint
      runs-on: ubuntu-latest
      steps:
        - name: Setup Go Environment
          uses: ./.github/workflows/common-setup-go.yml
          with:
            go-version: '1.21'
        - name: Go Mod Tidy
          working-directory: ./backend
          run: go mod tidy
        - name: Run golangci-lint
          uses: golangci/golangci-lint-action@v4
          with:
            version: v1.55
            working-directory: ./backend
            args: --timeout=5m --verbose
            skip-cache: false
            skip-pkg-cache: false
            skip-build-cache: false
          continue-on-error: true
  
        - name: Run basic Go checks
          working-directory: ./backend
          run: |
            echo "Running go fmt..."
            go fmt ./...
            echo "Running go vet..."
            go vet ./...
  
    frontend-lint:
      name: Frontend Lint
      runs-on: ubuntu-latest
      steps:
        - name: Setup Node.js Environment
          uses: ./.github/workflows/common-setup-node.yml
          with:
            node-version: '20'
            working-directory: './frontend'
        - name: Check ESLint config exists
          working-directory: ./frontend
          run: |
            if [ ! -f ".eslintrc.json" ]; then
              echo "ESLint config not found, creating default config..."
              echo '{"extends": ["next/core-web-vitals"]}' > .eslintrc.json
            fi
  
        - name: Type check
          working-directory: ./frontend
          run: npm run type-check
  
        - name: Lint
          working-directory: ./frontend
          run: npm run lint -- --max-warnings 0
